# Figures 2 & 3 replication

## Preprocessing
Using [GerryChain](https://github.com/mggg/GerryChain), we have generated block group-level dual graphs of the 20 states analyzed in Chen & Stephanopoulos 2021 with basic demographic information attached. Block groups are comparable in size to precincts or wards; as the U.S. Census reports precise demogrpahic statistics at the block group level, they are ideal units for our analysis of Black voting age population (BVAP) shares.  Using the algorithm in `1. generate_county_seeds.ipynb`, we have generated seed districting plans using a county-weighted recursive tree partitioning algorithm at three levels per state (U.S. House of Representatives, upper state legislature, lower state legislature). Most of these seed plans are roughly comparable to the enacted plans, with the advantage that they are natively constructed from block groups rather than roughly approximating enacted plans built from precincts. We set the maximum population deviation at 1% for U.S. House plans and 5% for other plans. These files, which are modified in place each time the notebook is run, can be found in `Seeding-Division-Splits/Output`.

In `2. Graph merging.ipynb`, we merge seed plans generated across the three levels, yielding a JSON file for each state. Each of these files contains a block group-level dual graph with (a) population/voting-age population from the Census and (b) three assignment columns corresponding to the three seed plans. These files can be found in `Seeding-Division-Splits/processed`. Furthermore, we provide alternate seed plans for California, Florida, and New York in `Seeding-Division-Splits/extra`. (TODO: why?)


## Running
We ran our experiments using `slurm` on Tufts' HPC cluster. The script `start_jobs.sh` is parameterized by the folder containing the input JSON files (first argument) and the target output folder (second argument). This script can be trivially modified to use an alternate job manager instead of `sbatch`. This script in turn invokes `cluster_runs.jl`, a thin command-line wrapper around GerryChain.jl. We include a version of GerryChain.jl dating to August 27, 2020 as a Git submodule in `GerryChainJulia` Output is serialized to Julia's [JLD format](https://github.com/JuliaIO/JLD.jl), which is roughly equivalent to the `pickle` format available in the Python ecosystem. We omit the output JLD files due to their large size (approximately 0.5GB/run).


## Postprocessing
We batch processed the JLD outputs of our runs into JSON-formatted summary statistics using `analyze_data.sh` (an orchestration script taking a directory of JLD files as the first argument and a target directory of JSON files as a second argument) and `parse_results.jl`. These summary statistics, which are available in `results`, were then further processed, joined with BVAP data from the enacted plan in `enacted_race_data`, and converted to a format suitable for rendering using TikZ using `3. TikZ postprocessing.ipynb`.